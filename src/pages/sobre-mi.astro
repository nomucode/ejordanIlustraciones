---
// src/pages/sobre-mi.astro
import Layout from "../layouts/Layout.astro";
import { getSobreMiPage } from "../lib/wp-graphql";
import { Image } from "astro:assets";

const {
  titulo,
  textoIntroductorio,
  trayectoria,
  visionArtistica,
  valores,
  cta,
} = await getSobreMiPage();

// Cada valor se convierte en un div con estilo de tarjeta
const valoresCardItems = valores
  .split("\n")
  .filter((item: string) => item.trim() !== "")
  .map(
    (item: string) =>
      `<div class="py-4 px-2 rounded-2xl bg-accent/30 shadow-lg flex items-center justify-center text-center" data-animate="zoom">
         <p class="text-lg text-zinc-600">${item.trim()}</p>
       </div>`
  );
---

<Layout title={titulo}>
  <article
    class="prose max-w-none prose-lg md:prose-xl mx-auto px-4 py-10 md:py-10"
  >
    <header class="text-center mb-12" data-animate="fade">
      <h2
        class="text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-secondary to-accent"
      >
        {titulo}
      </h2>
      <p class="mt-4 text-xl text-zinc-600 max-w-3xl mx-auto text-center">
        {textoIntroductorio}
      </p>
    </header>

    <div
      class="grid md:grid-cols-2 gap-16 md:gap-24 items-center w-3/4 mx-auto pt-10"
    >
      <section data-animate="left">
        <h2 class="text-4xl font-semibold mb-4 text-primary">Trayectoria</h2>
        <div set:html={trayectoria} class="text-zinc-700 leading-relaxed" />
      </section>

      <section data-animate="right">
        <h2 class="text-4xl font-semibold mb-4 text-primary">
          Visión Artística
        </h2>
        <div set:html={visionArtistica} class="text-zinc-700 leading-relaxed" />
      </section>

      <section class="md:col-span-2 text-center" data-animate="zoom">
        <h2 class="text-4xl font-semibold mb-4 text-primary">Valores</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto">
          {valoresCardItems.map((item: string) => <Fragment set:html={item} />)}
        </div>
      </section>
    </div>

    <footer class="text-center mt-12 md:mt-24" data-animate="up">
      <a
        href={cta.enlace.url}
        class="inline-block px-8 py-4 bg-primary text-white font-bold rounded-full shadow-lg hover:bg-transparent hover:text-primary border-2 border-primary transition-colors duration-300"
      >
        {cta.texto}
      </a>
    </footer>
  </article>

  <!-- Script de animaciones -->
  <script>
    const animations = {
      fade: ["opacity-0", "translate-y-10"],
      up: ["opacity-0", "translate-y-10"],
      left: ["opacity-0", "-translate-x-10"],
      right: ["opacity-0", "translate-x-10"],
      zoom: ["opacity-0", "scale-90"],
    };

    function initScrollAnimations() {
      const elements = document.querySelectorAll("[data-animate]");

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add(
                "opacity-100",
                "translate-y-0",
                "translate-x-0",
                "scale-100"
              );
              entry.target.classList.remove(
                "opacity-0",
                "translate-y-10",
                "-translate-x-10",
                "translate-x-10",
                "scale-90"
              );
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1 }
      );

      elements.forEach((el) => {
        const type = el.getAttribute("data-animate");
        const classes = animations[type] || animations.fade;

        el.classList.add(
          ...classes,
          "transition-all",
          "duration-1000",
          "ease-out"
        );
        observer.observe(el);
      });
    }

    if (typeof window !== "undefined") {
      initScrollAnimations();
    }
  </script>
</Layout>
