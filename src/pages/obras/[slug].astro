---
// src/pages/obras/[slug].astro
import Layout from "../../layouts/Layout.astro";
import { getAllObras, getObraBySlug } from "../../lib/wp-graphql";
import { Image } from "astro:assets"; // ✅ Usamos Image de astro:assets para mejor optimización

// PASO 1: getStaticPaths obtiene la LISTA de todas las obras para decirle a Astro qué páginas crear.
export async function getStaticPaths() {
  const todasLasObras = await getAllObras();

  return todasLasObras.map((obra) => ({
    params: { slug: obra.slug },
  }));
}

const { slug } = Astro.params;
const obra = await getObraBySlug(slug!);
---

<Layout title={`${obra.title} | Triz Jordan`}>
  <div class="max-w-6xl mx-auto px-4 py-8 md:py-16">
    {
      /* ✅ CORRECCIÓN 1: Se usa Grid correctamente. 1 columna en móvil, 5 en desktop. */
    }
    <div class="grid grid-cols-1 md:grid-cols-5 md:gap-12">
      {/* ✅ CORRECCIÓN 2: Sintaxis correcta 'md:col-span-3' */}
      <div class="md:col-span-3 mb-8 md:mb-0">
        {
          /* ✅ CORRECCIÓN 3: <Image> optimizada. width/height para la fuente, clases para el display. */
        }
        <Image
          class="w-full h-auto rounded-lg shadow-2xl"
          src={obra.featuredImage?.node.sourceUrl}
          alt={obra.featuredImage?.node.altText}
          width={800}
          height={1200}
          format="webp"
        />
      </div>

      <div class="md:col-span-2">
        <h1
          class="text-4xl md:text-5xl font-bold font-heading mb-4 bg-gradient-to-r from-primary to-accent text-transparent bg-clip-text"
        >
          {obra.title}
        </h1>

        {/* ✅ CORRECCIÓN 4: Margen responsive en la cita. */}
        <blockquote class="border-l-4 border-gray-300 pl-4 my-10">
          <p
            class="text-xl md:text-2xl text-gray-500 font-semibold italic md:mr-20"
          >
            {obra.datosDeLaObra?.textonarrativo}
          </p>
        </blockquote>

        <h2 class="text-2xl uppercase tracking-widest text-zinc-500 mb-2">
          Sobre la Obra
        </h2>
        <p
          class="font-sans text-md text-gray-600 leading-relaxed mb-6 text-pretty"
        >
          {obra.datosDeLaObra?.descripcion}
        </p>

        {
          /* ✅ CORRECCIÓN 5: Layout responsive para los detalles (columna en móvil, fila en desktop). */
        }
        <div class="flex flex-col md:flex-row gap-8 mt-8">
          <div>
            <h3 class="text-sm uppercase tracking-widest text-zinc-500 mb-1">
              Técnica
            </h3>
            <p class="text-xl text-zinc-800">{obra.datosDeLaObra?.tecnica}</p>
          </div>
          <div>
            <h3 class="text-sm uppercase tracking-widest text-zinc-500 mb-1">
              Dimensiones
            </h3>
            <p class="text-xl text-zinc-800">
              {obra.datosDeLaObra?.dimensiones}
            </p>
          </div>
          <div>
            <h3 class="text-sm uppercase tracking-widest text-zinc-500 mb-1">
              Año
            </h3>
            <p class="text-xl text-zinc-800">{obra.datosDeLaObra?.ano}</p>
          </div>
        </div>

        <div class="mt-12">
          {/* ✅ CORRECCIÓN 6: Estilo del enlace consistente con la web. */}
          <a href="/obras" class="text-primary font-semibold hover:underline">
            &larr; Volver a la galería
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>
