---
// src/pages/obras/[slug].astro
import Layout from "../../layouts/Layout.astro";
import { getAllObras, getObraBySlug } from "../../lib/wp-graphql";
import Image from "astro/components/Image.astro";

// PASO 1: getStaticPaths obtiene la LISTA de todas las obras para decirle a Astro qué páginas crear.
export async function getStaticPaths() {
  const todasLasObras = await getAllObras();

  // Debe devolver un array de objetos, cada uno con una clave "params".
  return todasLasObras.map((obra) => ({
    params: { slug: obra.slug },
  }));
}

// PASO 2: Este código se ejecuta para cada página individual que se está generando.
const { slug } = Astro.params; // Obtenemos el slug de la URL (ej: "la-pedorrina-salvaje")
const obra = await getObraBySlug(slug!); // Usamos ese slug para obtener los datos de ESTA obra
---

<Layout title={`${obra.title} | Beatriz Estebanez`}>
  <div class="max-w-6xl mx-auto px-4 py-8 md:py-16">
    <div class="grid grid-cols-1 md:grid-cols-5 md:gap-12">
      <div class="md-col-span-3 mb-8 md:mb-0">
        <img
          src={obra.featuredImage?.node.sourceUrl}
          alt={obra.featuredImage?.node.altText}
          class="rounded-lg shadow-2xl w-full h-auto object-cover"
        />
      </div>
      <div class="md-col-span-2">
        <h1 class="text-4xl md:text-5xl font-bold text-zinc-900 mb-4">
          {obra.title}
        </h1>

        {}
        <p class="text-lg text-zinc-700 leading-relaxed mb-6">
          {obra.datosDeLaObra?.descripcion}
        </p>

        <div>
          <h2 class="text-sm uppercase tracking-widest text-zinc-500 mb-2">
            Año
          </h2>
          <p class="text-xl text-zinc-800">{obra.datosDeLaObra?.ano}</p>
        </div>

        <div class="mt-8">
          <a href="/obras" class="text-pink-600 hover:underline">
            &larr; Volver a la galería
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>
